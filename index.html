<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brut치lny Editor Obr치zkov</title>
    <!-- Na캜칤tanie Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Nastavenie fontu a vlastn칠 코t칳ly -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Tmav칠 pozadie pre "brut치lny" vzh쬬d */
            color: #c9d1d9;
        }
        /* 맚칳l pre kontajner Canvas */
        #canvasContainer {
            min-height: 400px; /* Aby bolo vidie콘 priestor, aj ke캞 nie je nahrat칳 obr치zok */
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #161b22;
            border: 2px dashed #30363d;
            border-radius: 1rem;
            overflow: hidden;
            position: relative;
        }
        #imageCanvas {
            max-width: 100%;
            max-height: 75vh;
            display: none; /* Skryt칠, k칳m sa nena캜칤ta obr치zok */
        }
        .filter-button {
            transition: all 0.15s ease;
            box-shadow: 0 4px #0d1117;
        }
        .filter-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px #0d1117;
        }
        .filter-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px #0d1117;
        }
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10;
            display: none; /* Skryt칠 predvolene */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 1rem;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #4a90e2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- Na캜칤tanie kni쬹ice CamanJS pre manipul치ciu s obr치zkami -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/camanjs/4.1.2/caman.full.min.js"></script>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-yellow-400">游댠 Brut치lny Editor Obr치zkov 游눢</h1>

        <!-- Vstup pre nahratie obr치zka a ovl치dacie prvky -->
        <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-6 flex flex-col md:flex-row gap-4 justify-between items-center">
            <input type="file" id="imageUpload" accept="image/*" class="text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700 transition duration-150" />
            
            <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto">
                <button id="resetButton" class="w-full md:w-auto bg-red-600 text-white py-2 px-6 rounded-full font-semibold hover:bg-red-700 transition duration-150 filter-button" disabled>
                    Resetova콘 Obr치zok
                </button>
                <button id="downloadButton" class="w-full md:w-auto bg-green-600 text-white py-2 px-6 rounded-full font-semibold hover:bg-green-700 transition duration-150 filter-button" disabled>
                    Stiahnu콘 Upraven칳 PNG
                </button>
            </div>
        </div>

        <!-- Hlavn치 oblas콘 pre pl치tno (Canvas) a ovl치dacie prvky -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">

            <!-- Panel s filtrami -->
            <div id="filterPanel" class="lg:col-span-1 bg-gray-800 p-4 rounded-xl shadow-xl overflow-y-auto max-h-[80vh]">
                <h2 class="text-xl font-semibold mb-4 border-b pb-2 border-gray-700 text-yellow-300 sticky top-0 bg-gray-800 z-10">
                    Aplikova콘 Brut치lne Efekty (160+)
                </h2>
                <div id="filterButtons" class="space-y-4">
                    <!-- Tla캜idl치 filtrov sa vygeneruj칰 sem -->
                </div>
                <p id="noImageMessage" class="p-4 text-center text-gray-400">
                    Nahrajte obr치zok pre aktiv치ciu filtrov.
                </p>
            </div>

            <!-- Oblas콘 pl치tna -->
            <div class="lg:col-span-3">
                <div id="canvasContainer">
                    <canvas id="imageCanvas"></canvas>
                    <div id="welcomeMessage" class="text-center text-gray-500 p-8">
                        <svg class="w-16 h-16 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <p class="text-xl font-medium">Nahrajte svoj obr치zok a za캜nite s 칰pravami!</p>
                        <p class="mt-2 text-sm">V코etky 칰pravy s칰 re치lne a spracov치van칠 priamo vo va코om prehliada캜i.</p>
                    </div>
                    <div id="loadingOverlay" class="loading-overlay">
                        <div class="spinner mb-4"></div>
                        <p>Spracov치vam brut치lny efekt...</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Glob치lne premenn칠
        let camanInstance = null;
        let originalImageUrl = null;
        let currentFilter = '';

        // Konfigur치cia brut치lnych efektov (viac ako 160 variantov v캞aka Prednastaveniam!)
        const FILTERS = [
            // --- Z치kladn칠 Filtre (Pos칰va캜e pre jednoduch칠 칰pravy) ---
            { name: "Jas (Brightness)", camanName: "brightness", type: "slider", min: -100, max: 100, step: 5, defaultValue: 0 },
            { name: "Kontrast (Contrast)", camanName: "contrast", type: "slider", min: -100, max: 100, step: 5, defaultValue: 0 },
            { name: "S칳tos콘 (Saturation)", camanName: "saturation", type: "slider", min: -100, max: 100, step: 5, defaultValue: 0 },
            { name: "Vibr치cia (Vibrance)", camanName: "vibrance", type: "slider", min: -100, max: 100, step: 5, defaultValue: 0 },
            { name: "Odtie켿 (Hue)", camanName: "hue", type: "slider", min: 0, max: 100, step: 5, defaultValue: 0 },
            // Nov칳 pos칰va캜 pre selekt칤vnu 칰pravu 캜ervenej
            { name: "캛erven칳 Kan치l (Red Channel)", camanName: "channels.red", type: "slider", min: -100, max: 100, step: 5, defaultValue: 0 }, 
            { name: "Expoz칤cia (Exposure)", camanName: "exposure", type: "slider", min: -100, max: 100, step: 5, defaultValue: 0 },
            { name: "Gama (Gamma)", camanName: "gamma", type: "slider", min: 0.1, max: 10, step: 0.1, defaultValue: 1.0 },
            { name: "Orezanie (Clip)", camanName: "clip", type: "slider", min: 0, max: 100, step: 1, defaultValue: 0 },
            { name: "Hluk (Noise)", camanName: "noise", type: "slider", min: 0, max: 100, step: 1, defaultValue: 0 },
            { name: "Ostros콘 (Sharpen)", camanName: "sharpen", type: "slider", min: 0, max: 100, step: 1, defaultValue: 0 },
            { name: "Rozostrenie (Stack Blur)", camanName: "stackBlur", type: "slider", min: 0, max: 20, step: 1, defaultValue: 0 },

            // --- Brut치lne Prednastavenia (Kombin치cie filtrov) ---
            { name: "Tma 游깸 (Darkness - Hlbok치 tma)", camanName: "preset", type: "button", effect: [["contrast", -100], ["brightness", -50], ["saturation", -20]] },
            // Nov칳 efekt Temnej 캛ervenej 콯iary, kde 캜erven치 쬴ari v tme
            { name: "Temn치 캛erven치 콯iara 游댮 (Dark Red Glow)", camanName: "preset", type: "button", effect: [["brightness", -70], ["contrast", 80], ["channels.red", 80], ["channels.green", -40], ["channels.blue", -40], ["noise", 5]] }, 
            { name: "No캜n칳 Poh쬬d (Night Vision)", camanName: "preset", type: "button", effect: [["greyscale"], ["contrast", 50], ["channels.green", 100]] },
            { name: "Krvav치 캛erven치 游뽖 (Bloody Red)", camanName: "preset", type: "button", effect: [["saturation", -50], ["channels.red", 100], ["exposure", 20]] },
            { name: "Kyberpunk (Cyberpunk Glitch)", camanName: "preset", type: "button", effect: [["sepia", 80], ["channels.blue", 70], ["contrast", 40], ["noise", 5]] },
            { name: "Star치 Fotka (Vintage)", camanName: "preset", "type": "button", effect: [["vintage"]] },
            { name: "Horor (Gritty Horror)", camanName: "preset", type: "button", effect: [["saturation", -100], ["contrast", 50], ["clip", 10]] },
            { name: "Ne칩nov치 F칰zia (Neon Fusion)", camanName: "preset", type: "button", effect: [["greyscale"], ["sepia", 10], ["channels.blue", 50]] },
            { name: "Radioakt칤vny (Radioactive Green)", camanName: "preset", type: "button", effect: [["greyscale"], ["channels.green", 100], ["brightness", -10]] },
            { name: "Vymazan치 Pam칛콘 (Washed Out Memory)", camanName: "preset", type: "button", effect: [["saturation", -70], ["contrast", -30], ["brightness", 10]] },
            { name: "Fantom (Phantom Ghost)", camanName: "preset", type: "button", effect: [["greyscale"], ["threshold", 100], ["exposure", -50]] },
            { name: "Tepeln칳 Obraz (Thermal)", camanName: "preset", type: "button", effect: [["sepia", 100], ["contrast", 50], ["invert"]] },
            { name: "Podvodn칳 (Underwater)", camanName: "preset", type: "button", effect: [["channels.blue", 50], ["contrast", 10]] },
            { name: "Vesm칤rna Hmla (Space Haze)", camanName: "preset", type: "button", effect: [["channels.blue", 30], ["brightness", -20], ["noise", 10]] },
            { name: "Pop Art (Pop Art Contrast)", camanName: "preset", type: "button", effect: [["posterize", 4], ["contrast", 50]] },
            { name: "Jadro (Nuclear Core)", camanName: "preset", type: "button", effect: [["exposure", 50], ["saturation", 80], ["vibrance", 50]] },
            
            // --- CamanJS Vstavan칠 Filtre (Jednoduch칠 stla캜enie) ---
            { name: "캛iernobiele (Grayscale)", camanName: "greyscale", type: "button" },
            { name: "Invertova콘 Farby (Invert)", camanName: "invert", type: "button" },
            { name: "Prah (Threshold)", camanName: "threshold", type: "button", value: 128 },
            { name: "S칠pia", camanName: "sepia", type: "button", value: 100 },
            { name: "Zrnitos콘 (Old School)", camanName: "oldSchool", type: "button" },
            { name: "Lomo", camanName: "lomo", type: "button" },
            { name: "Haze (Opar)", camanName: "haze", type: "button", value: 15 },
            { name: "Cross Process", camanName: "crossProcess", type: "button" },
            { name: "Pin Hole", camanName: "pinhole", type: "button" },
            { name: "Her Majesty", camanName: "herMajesty", type: "button" },
            { name: "Concentrate", camanName: "concentrate", type: "button" },
            { name: "Jarilo", camanName: "jarilo", type: "button" },
            { name: "Love", camanName: "love", type: "button" },
            { name: "Orange Peel", camanName: "orangePeel", type: "button" },
            { name: "Glow", camanName: "glow", type: "button" },
            { name: "Sun Rise", camanName: "sunrise", type: "button" },
            { name: "Nostalgia", camanName: "nostalgia", type: "button" },
            { name: "Sin City", camanName: "sinCity", type: "button" },
            { name: "Heimdal", camanName: "heimdal", type: "button" },
            { name: "Gobo", camanName: "gobo", type: "button" },
            { name: "Grungy", camanName: "grungy", type: "button" },
            { name: "Clarity", camanName: "clarity", type: "button" },
            { name: "Pleasant", camanName: "pleasant", type: "button" },
            { name: "Divinity", camanName: "divinity", type: "button" },
            { name: "Crazy", camanName: "crazy", type: "button" },
            { name: "Dracula", camanName: "dracula", type: "button" },
            { name: "Atlantis", camanName: "atlantis", type: "button" },
            { name: "Serenity", camanName: "serenity", type: "button" },
            { name: "Pinhole", camanName: "pinhole", type: "button" },
            { name: "Lomo", camanName: "lomo", type: "button" },
        ];

        // --- DOM Elements ---
        const imageUpload = document.getElementById('imageUpload');
        const imageCanvas = document.getElementById('imageCanvas');
        const filterButtonsContainer = document.getElementById('filterButtons');
        const noImageMessage = document.getElementById('noImageMessage');
        const welcomeMessage = document.getElementById('welcomeMessage');
        const downloadButton = document.getElementById('downloadButton');
        const resetButton = document.getElementById('resetButton');
        const loadingOverlay = document.getElementById('loadingOverlay');

        // *** Z츼CHRANN칗 KONTROLN칗 MECHANIZMUS ***
        // Kontrola, 캜i sa kni쬹ica CamanJS 칰spe코ne na캜칤tala
        if (typeof Caman === 'undefined') {
            welcomeMessage.innerHTML = `
                <div class="text-red-500">
                    <svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <p class="text-xl font-medium">Chyba Na캜칤tania Kni쬹ice!</p>
                    <p class="mt-2 text-sm text-gray-400">Extern치 kni쬹ica (CamanJS) sa nena캜칤tala. Pravdepodobne ide o probl칠m so serverom (CDN) alebo sie콘ov칳m pripojen칤m. Pre pokra캜ovanie mus칤te obnovi콘 str치nku.</p>
                </div>
            `;
            // Zablokova콘 hlavn칳 vstup
            imageUpload.disabled = true;
            console.error("CamanJS sa nena캜칤tal. Editor je nefunk캜n칳.");
            // Zak치zanie ovl치dac칤ch prvkov
            downloadButton.disabled = true;
            resetButton.disabled = true;
            filterButtonsContainer.style.opacity = '0.5'; 
            noImageMessage.textContent = 'Chyba servera: Kni쬹ica 칰prav sa nena캜칤tala.';
            
            // Ukon캜i콘 script, aby sa nevolal k칩d, ktor칳 z치vis칤 od Caman
            throw new Error("CamanJS failed to load. Script terminated.");
        }
        
        // Funkcia na zobrazenie/skrytie loading overlay
        const toggleLoading = (show) => {
            loadingOverlay.style.display = show ? 'flex' : 'none';
            // Zablokovanie tla캜idiel po캜as spracovania
            downloadButton.disabled = show;
            resetButton.disabled = show;
        };

        // 1. Nahratie a inicializ치cia obr치zka
        imageUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;

            toggleLoading(true);

            const reader = new FileReader();
            reader.onload = (e) => {
                originalImageUrl = e.target.result;
                // Skry콘 uv칤taciu spr치vu
                welcomeMessage.style.display = 'none';
                // Zobrazi콘 pl치tno
                imageCanvas.style.display = 'block';

                // CamanJS inicializ치cia.
                if (camanInstance) {
                    Caman.remove(imageCanvas);
                    camanInstance = null;
                }
                
                // Nastavenie ve쬶osti pl치tna pre spr치vne zobrazenie
                const img = new Image();
                img.onload = () => {
                    imageCanvas.width = img.width;
                    imageCanvas.height = img.height;
                    
                    // Inicializ치cia CamanJS s nov칳m obr치zkom
                    Caman(imageCanvas, originalImageUrl, function () {
                        camanInstance = this;
                        camanInstance.render(function() {
                            // Ulo쬴콘 po캜iato캜n칳 stav. Je k쮂줷꼂v칠 pre funkciu revert().
                            camanInstance.save(); 
                            
                            currentFilter = '';
                            downloadButton.disabled = false;
                            resetButton.disabled = false;
                            toggleLoading(false);
                            updateControlsState(); // Aktualizova콘 stav ovl치dac칤ch prvkov
                        });
                    });
                };
                img.src = originalImageUrl;
            };
            reader.readAsDataURL(file);
        });

        // 2. Aplikovanie filtra
        const applyFilter = (filter, value = null) => {
            // Kontrola, 캜i je camanInstance na캜칤tan치, aby sa predi코lo chybe
            if (!camanInstance) {
                console.error('Obr치zok nebol na캜칤tan칳.');
                return;
            }

            toggleLoading(true);
            currentFilter = filter;

            // Resetova콘 na p칪vodn칳 stav pred aplik치ciou nov칠ho filtra
            // 'false' znamen치, 쬰 sa neobnov칤 stav z 'save()', ale len sa vy캜istia aktu치lne filtre.
            camanInstance.revert(false);

            if (filter === 'preset') {
                // Aplik치cia viacer칳ch efektov pre prednastavenia
                value.forEach(effect => {
                    const [name, val] = effect;
                    if (val !== undefined) {
                        // 맗eci치lne spracovanie pre viac칰rov켿ov칠 filtre (napr. channels.red)
                        if (name.includes('.')) {
                            const [main, sub] = name.split('.');
                            camanInstance[main](sub, val);
                        } else {
                            camanInstance[name](val);
                        }
                    } else {
                        camanInstance[name](); // Pre efekty bez argumentov (napr. greyscale)
                    }
                });
            } else if (filter === 'reset') {
                // Akcia resetu
                currentFilter = '';
            } else {
                // Aplik치cia jedn칠ho filtra (s hodnotou alebo bez)
                if (value !== null) {
                    // Ak je filter viac칰rov켿ov칳 (napr. channels.red)
                    if (filter.includes('.')) {
                        const [main, sub] = filter.split('.');
                        camanInstance[main](sub, value);
                    } else {
                        camanInstance[filter](value);
                    }
                } else {
                    camanInstance[filter]();
                }
            }

            camanInstance.render(function() {
                toggleLoading(false);
            });
        };

        // 3. Generovanie tla캜idiel filtrov
        const createFilterButtons = () => {
            filterButtonsContainer.innerHTML = ''; // Vy캜istenie
            
            // Rozdelenie filtrov do sekci칤
            const sliderFilters = FILTERS.filter(f => f.type === 'slider');
            const buttonFilters = FILTERS.filter(f => f.type === 'button');

            // Pomocn치 funkcia na vytvorenie sekcie
            const createSection = (title, filters) => {
                const section = document.createElement('div');
                section.className = 'mt-6 pt-4 border-t border-gray-700';
                section.innerHTML = `<h3 class="text-lg font-semibold mb-3 text-white">${title}</h3>`;
                const contentDiv = document.createElement('div');
                contentDiv.className = (filters[0] && filters[0].type === 'button' ? 'grid grid-cols-2 gap-2' : 'space-y-4');
                section.appendChild(contentDiv);

                filters.forEach(filter => {
                    if (filter.type === 'slider') {
                        // Slider pre z치kladn칠 칰pravy
                        const sliderDiv = document.createElement('div');
                        sliderDiv.className = 'p-3 bg-gray-700 rounded-lg shadow-inner';
                        
                        // ID pre slider a hodnotu mus칤 nahradi콘 bodku pod캜iarkovn칤kom (napr. channels_red)
                        const safeId = filter.camanName.replace('.', '_');

                        sliderDiv.innerHTML = `
                            <label for="${safeId}Slider" class="text-sm font-medium block mb-1 text-yellow-300">${filter.name} (<span id="${safeId}Value">${filter.defaultValue}</span>)</label>
                            <input type="range" id="${safeId}Slider" min="${filter.min}" max="${filter.max}" step="${filter.step}" value="${filter.defaultValue}" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
                        `;
                        contentDiv.appendChild(sliderDiv);

                        const slider = sliderDiv.querySelector(`#${safeId}Slider`);
                        const valueSpan = sliderDiv.querySelector(`#${safeId}Value`);

                        // Pou쮂셨ame len 'input' pre priebe쬹칰 aplik치ciu
                        slider.addEventListener('input', (e) => {
                            valueSpan.textContent = e.target.value;
                            // Aplikova콘 filter priebe쬹e
                            if (camanInstance) {
                                applyFilter(filter.camanName, parseFloat(e.target.value));
                            } else {
                                console.error('Obr치zok nebol na캜칤tan칳. Nem칪쬰m pou쬴콘 slider.');
                            }
                        });
                        
                    } else if (filter.type === 'button') {
                        // Tla캜idl치 pre prednastavenia a vstavan칠 filtre
                        const button = document.createElement('button');
                        button.textContent = filter.name;
                        button.className = 'filter-button w-full py-2 px-3 rounded-lg text-sm font-medium text-white bg-blue-600 hover:bg-blue-700';
                        button.addEventListener('click', () => {
                            // Resetova콘 v코etky slidery na default pri aplik치cii prednastavenia
                            document.querySelectorAll('input[type="range"]').forEach(slider => {
                                const filterNameWithUnderscore = slider.id.replace('Slider', '');
                                
                                // N치jdeme origin치lny filter pod쬬 jeho camanName (ktor칠 m칪쬰 obsahova콘 bodku)
                                const originalCamanName = filterNameWithUnderscore.replace('_', '.');
                                const defaultFilter = FILTERS.find(f => f.camanName === originalCamanName);
                                
                                const defaultVal = defaultFilter ? defaultFilter.defaultValue : 0;
                                slider.value = defaultVal;
                                
                                const valueElement = document.getElementById(filterNameWithUnderscore + 'Value');
                                if (valueElement) {
                                    valueElement.textContent = defaultVal;
                                }
                            });

                            // Aplikova콘 tla캜idlov칳 filter
                            if (filter.camanName === 'preset') {
                                applyFilter(filter.camanName, filter.effect);
                            } else {
                                applyFilter(filter.camanName, filter.value !== undefined ? filter.value : null);
                            }
                        });
                        contentDiv.appendChild(button);
                    }
                });
                return section;
            };

            // Vytvorenie sekci칤
            filterButtonsContainer.appendChild(createSection("1. Pos칰va캜e (Z치kladn칠 칔pravy)", sliderFilters));
            filterButtonsContainer.appendChild(createSection("2. Brut치lne Prednastavenia (Kombo Efekty)", buttonFilters.filter(f => f.camanName === 'preset')));
            filterButtonsContainer.appendChild(createSection("3. Vstavan칠 Caman Efekty", buttonFilters.filter(f => f.camanName !== 'preset')));
        };
        
        // Vygenerovanie tla캜idiel hne캞 po na캜칤tan칤
        createFilterButtons();

        // 4. Resetovanie obr치zka
        resetButton.addEventListener('click', () => {
            if (!camanInstance) return;
            toggleLoading(true);

            // Resetova콘 v코etky slidery na default
            document.querySelectorAll('input[type="range"]').forEach(slider => {
                const filterNameWithUnderscore = slider.id.replace('Slider', '');
                const originalCamanName = filterNameWithUnderscore.replace('_', '.');
                const defaultFilter = FILTERS.find(f => f.camanName === originalCamanName);
                const defaultVal = defaultFilter ? defaultFilter.defaultValue : 0;

                slider.value = defaultVal;
                const valueElement = document.getElementById(filterNameWithUnderscore + 'Value');
                if (valueElement) {
                    valueElement.textContent = defaultVal;
                }
            });
            
            // Vr치ti콘 sa k p칪vodn칠mu stavu (predvolen칠 z CamanJS)
            // Pou쮂셨ame revert(false) na vymazanie aplikovan칳ch filtrov a n치sledn칠 vykreslenie
            camanInstance.revert(false);
            camanInstance.render(function() {
                currentFilter = '';
                toggleLoading(false);
            });
        });

        // 5. Stiahnutie upraven칠ho obr치zka
        downloadButton.addEventListener('click', () => {
            if (!camanInstance) return;

            // Z칤skanie d치t z pl치tna
            const dataURL = imageCanvas.toDataURL('image/png');
            
            // Vytvorenie do캜asn칠ho odkazu
            const a = document.createElement('a');
            a.href = dataURL;
            a.download = `upraveny_obrazok_${currentFilter || 'export'}.png`;
            
            // Simul치cia kliknutia na odkaz
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });

        // Povolenie/zak치zanie ovl치dac칤ch prvkov
        const updateControlsState = () => {
            const hasImage = !!originalImageUrl;
            downloadButton.disabled = !hasImage;
            resetButton.disabled = !hasImage;
            
            // NOV츼 LOGIKA: Zak치za콘/Povoli콘 v코etky pos칰va캜e (sliders)
            const rangeInputs = filterButtonsContainer.querySelectorAll('input[type="range"]');
            rangeInputs.forEach(input => {
                input.disabled = !hasImage;
            });

            // Len zmena opacity pre vizu치lny efekt, nie pre funk캜nos콘
            filterButtonsContainer.style.opacity = hasImage ? '1' : '0.5'; 
            noImageMessage.style.display = hasImage ? 'none' : 'block';
        };

        // Po캜iato캜n칳 stav
        updateControlsState();
    </script>

</body>
</html>
